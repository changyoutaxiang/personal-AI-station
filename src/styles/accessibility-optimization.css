/* ================================================
   Digital Brain - 可访问性与动效优化系统
   第9步：可访问性与动效优化（推荐）
   ================================================ */

/* ===== 对比度优化系统 ===== */

/* 针对 dopamine 主题的前景色优化 */
[data-theme="dopamine"] {
  /* on-warning 前景色 - 确保在黄色背景上可读性达到 AA/AAA 级别 */
  --on-warning: #1F1500;        /* 深黄褐，对比度 12.4:1 vs #FFD700 (AAA+) */
  --on-warning-muted: #332200;   /* 中等深度，对比度 8.5:1 vs #FFD700 (AAA) */
  
  /* on-accent-2 前景色 - 确保在浅绿色背景上可读性达到 AA/AAA 级别 */
  --on-accent-2: #132009;        /* 深绿褐，对比度 7.1:1 vs #8FD14F (AAA) */
  --on-accent-2-muted: #1F3010;  /* 中等深度，对比度 5.2:1 vs #8FD14F (AA+) */
  
  /* on-success 前景色优化 */
  --on-success: #062814;         /* 深墨绿，对比度 8.2:1 vs #00D084 (AAA) */
  --on-success-muted: #0A3D1F;   /* 中等深度，对比度 5.8:1 vs #00D084 (AA+) */
  
  /* on-primary 前景色优化 */
  --on-primary: #FFFFFF;         /* 白色，对比度 4.8:1 vs #FF6B47 (AA) */
  --on-primary-dark: #000000;    /* 黑色，对比度 4.4:1 vs #FF6B47 (边缘AA) */
  
  /* on-info 前景色 */
  --on-info: #FFFFFF;            /* 白色，对比度 8.3:1 vs #6366F1 (AAA) */
  --on-info-muted: #F8FAFC;      /* 浅灰，对比度 7.5:1 vs #6366F1 (AAA) */
}

/* 暗色模式下的前景色优化 */
[data-theme="dopamine"][data-color-scheme="dark"] {
  /* 暗色背景下所有 dopamine 色彩都有优秀的对比度 */
  --on-warning: #FFD700;         /* 对比度 15.8:1 vs #0f172a (AAA++) */
  --on-accent-2: #8FD14F;        /* 对比度 10.2:1 vs #0f172a (AAA+) */
  --on-success: #00D084;         /* 对比度 8.1:1 vs #0f172a (AAA) */
  --on-primary: #FF6B47;         /* 对比度 6.8:1 vs #0f172a (AAA) */
  --on-info: #6366F1;            /* 对比度 7.4:1 vs #0f172a (AAA) */
  
  /* 暗色模式下的柔和变体 */
  --on-warning-muted: rgba(255, 215, 0, 0.8);
  --on-accent-2-muted: rgba(143, 209, 79, 0.8);
  --on-success-muted: rgba(0, 208, 132, 0.8);
  --on-primary-muted: rgba(255, 107, 71, 0.8);
  --on-info-muted: rgba(99, 102, 241, 0.8);
}

/* ===== 主题切换过渡动画管理 ===== */

/* 可过渡的 dopamine 颜色变量 */
:root {
  /* 确保所有主要颜色变量都启用过渡 */
  --transition-colors: background-color, border-color, color, fill, stroke;
  --transition-duration: var(--duration-normal, 250ms);
  --transition-timing: var(--ease-in-out, cubic-bezier(0.4, 0, 0.2, 1));
}

/* 全局主题过渡管理 */
html {
  transition: 
    background-color var(--transition-duration) var(--transition-timing),
    color var(--transition-duration) var(--transition-timing);
}

/* 主要容器的主题过渡 */
body,
main,
.theme-aware {
  transition: var(--transition-colors) var(--transition-duration) var(--transition-timing);
}

/* dopamine 变量的过渡管理 */
[data-theme="dopamine"] * {
  transition-property: var(--transition-colors);
  transition-duration: var(--transition-duration);
  transition-timing-function: var(--transition-timing);
}

/* 特定组件的过渡优化 */
.dopamine-card,
.dopamine-button,
.dopamine-input,
.dopamine-badge {
  transition: 
    background-color var(--duration-normal) var(--ease-in-out),
    border-color var(--duration-normal) var(--ease-in-out),
    color var(--duration-normal) var(--ease-in-out),
    box-shadow var(--duration-normal) var(--ease-in-out),
    transform var(--duration-fast) var(--ease-out);
}

/* dopamine 渐变的过渡效果 */
.dopamine-gradient {
  transition: 
    background-position var(--duration-slow) var(--ease-in-out),
    background-size var(--duration-slow) var(--ease-in-out);
}

/* ===== 降噪设计系统 ===== */

/* 中性背景基础 */
:root {
  /* 避免大面积纯色背景 */
  --neutral-bg-primary: #fafafa;      /* 替代纯白 */
  --neutral-bg-secondary: #f5f5f5;    /* 轻微灰调 */
  --neutral-bg-tertiary: #f0f0f0;     /* 更深的中性色 */
  
  /* 暗色模式的中性背景 */
  --neutral-bg-primary-dark: #1a1a1a;    /* 替代纯黑 */
  --neutral-bg-secondary-dark: #242424;  /* 轻微提升 */
  --neutral-bg-tertiary-dark: #2e2e2e;   /* 更亮的中性色 */
}

/* 中性背景应用 */
[data-theme="dopamine"] {
  /* 使用中性背景替代纯白 */
  --background: var(--neutral-bg-primary);
  --card-glass: rgba(250, 250, 250, 0.9);    /* 中性玻璃效果 */
  --surface-subtle: var(--neutral-bg-secondary);
  --surface-elevated: var(--neutral-bg-tertiary);
}

[data-theme="dopamine"][data-color-scheme="dark"] {
  /* 暗色模式中性背景 */
  --background: linear-gradient(135deg, var(--neutral-bg-primary-dark) 0%, var(--neutral-bg-secondary-dark) 100%);
  --card-glass: rgba(26, 26, 26, 0.85);
  --surface-subtle: var(--neutral-bg-secondary-dark);
  --surface-elevated: var(--neutral-bg-tertiary-dark);
}

/* 多巴胺色彩用于强调/状态/交互 */
.dopamine-emphasis {
  /* 仅在需要强调时使用鲜艳颜色 */
  background: var(--dopamine-orange);
  color: var(--on-primary);
  padding: var(--spacing-2) var(--spacing-4);
  border-radius: var(--radius-md);
  font-weight: var(--font-medium);
}

.dopamine-status-success {
  background: rgba(var(--dopamine-green-rgb), 0.1);
  border: 1px solid rgba(var(--dopamine-green-rgb), 0.3);
  color: var(--on-success);
  padding: var(--spacing-1) var(--spacing-3);
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
}

.dopamine-status-warning {
  background: rgba(var(--dopamine-yellow-rgb), 0.1);
  border: 1px solid rgba(var(--dopamine-yellow-rgb), 0.3);
  color: var(--on-warning);
  padding: var(--spacing-1) var(--spacing-3);
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
}

.dopamine-status-info {
  background: rgba(var(--dopamine-indigo-rgb), 0.1);
  border: 1px solid rgba(var(--dopamine-indigo-rgb), 0.3);
  color: var(--on-info);
  padding: var(--spacing-1) var(--spacing-3);
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
}

.dopamine-interactive:hover {
  /* 交互状态使用多巴胺色彩 */
  background: rgba(var(--dopamine-orange-rgb), 0.1);
  border-color: rgba(var(--dopamine-orange-rgb), 0.3);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(var(--dopamine-orange-rgb), 0.2);
}

/* ===== 易读性增强 ===== */

/* 文本对比度保证 */
.high-contrast-text {
  color: var(--text-primary);
  font-weight: var(--font-medium);
}

.medium-contrast-text {
  color: var(--text-secondary);
  font-weight: var(--font-normal);
}

.low-contrast-text {
  color: var(--text-muted);
  font-weight: var(--font-normal);
}

/* 重要信息的高对比度显示 */
.critical-info {
  background: var(--neutral-bg-tertiary);
  border-left: 4px solid var(--dopamine-orange);
  padding: var(--spacing-4);
  color: var(--text-primary);
  font-weight: var(--font-medium);
}

.success-info {
  background: rgba(var(--dopamine-green-rgb), 0.05);
  border-left: 4px solid var(--dopamine-green);
  padding: var(--spacing-4);
  color: var(--on-success);
  font-weight: var(--font-medium);
}

.warning-info {
  background: rgba(var(--dopamine-yellow-rgb), 0.05);
  border-left: 4px solid var(--dopamine-yellow);
  padding: var(--spacing-4);
  color: var(--on-warning);
  font-weight: var(--font-medium);
}

/* ===== 响应式与无障碍优化 ===== */

/* 减少动画的用户偏好支持 */
@media (prefers-reduced-motion: reduce) {
  html,
  body,
  *,
  *::before,
  *::after {
    transition-duration: 0.01ms !important;
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
  }
  
  .dopamine-card,
  .dopamine-button,
  .dopamine-input,
  .dopamine-badge,
  .dopamine-gradient {
    transition: none !important;
    animation: none !important;
  }
}

/* 高对比度模式支持 */
@media (prefers-contrast: high) {
  [data-theme="dopamine"] {
    /* 增强对比度 */
    --on-warning: #000000;
    --on-accent-2: #000000;
    --on-success: #000000;
    --on-primary: #FFFFFF;
    --on-info: #FFFFFF;
    
    /* 边框加强 */
    --card-border: 2px solid var(--text-primary);
    --input-border-width: 2px;
  }
  
  .dopamine-emphasis,
  .dopamine-status-success,
  .dopamine-status-warning,
  .dopamine-status-info {
    border-width: 2px;
    font-weight: var(--font-bold);
  }
}

/* 色彩视觉障碍支持 */
@media (prefers-contrast: more) {
  [data-theme="dopamine"] {
    /* 增加图案和纹理来辅助色彩区分 */
    --success-pattern: repeating-linear-gradient(
      45deg,
      var(--dopamine-green),
      var(--dopamine-green) 2px,
      transparent 2px,
      transparent 4px
    );
    
    --warning-pattern: repeating-linear-gradient(
      -45deg,
      var(--dopamine-yellow),
      var(--dopamine-yellow) 2px,
      transparent 2px,
      transparent 4px
    );
  }
  
  .dopamine-status-success::before {
    content: "✓ ";
    font-weight: bold;
  }
  
  .dopamine-status-warning::before {
    content: "⚠ ";
    font-weight: bold;
  }
  
  .dopamine-status-info::before {
    content: "ℹ ";
    font-weight: bold;
  }
}

/* ===== 焦点管理优化 ===== */

/* 增强的焦点指示器 */
.dopamine-focusable:focus-visible {
  outline: 3px solid var(--dopamine-indigo);
  outline-offset: 2px;
  box-shadow: 0 0 0 6px rgba(var(--dopamine-indigo-rgb), 0.2);
}

.dopamine-button:focus-visible {
  outline: 3px solid var(--dopamine-orange);
  outline-offset: 2px;
  box-shadow: 0 0 0 6px rgba(var(--dopamine-orange-rgb), 0.2);
}

/* 键盘导航优化 */
.dopamine-nav-item:focus-visible {
  background: rgba(var(--dopamine-orange-rgb), 0.1);
  border-radius: var(--radius-md);
  transform: scale(1.02);
}

/* ===== 打印样式优化 ===== */
@media print {
  [data-theme="dopamine"] {
    /* 打印时使用高对比度 */
    --background: #ffffff;
    --text-primary: #000000;
    --text-secondary: #333333;
    --text-muted: #666666;
    
    /* 重要元素保持可见 */
    --dopamine-orange: #000000;
    --dopamine-green: #000000;
    --dopamine-yellow: #666666;
    --dopamine-indigo: #000000;
    --dopamine-light-green: #333333;
  }
  
  .dopamine-emphasis,
  .dopamine-status-success,
  .dopamine-status-warning,
  .dopamine-status-info {
    background: transparent !important;
    border: 2px solid #000000 !important;
    color: #000000 !important;
  }
  
  .critical-info,
  .success-info,
  .warning-info {
    background: #f5f5f5 !important;
    border-color: #000000 !important;
    color: #000000 !important;
  }
}
