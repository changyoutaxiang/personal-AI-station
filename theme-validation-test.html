<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>暗色模式选择器校验 - Digital Brain</title>
    <link rel="stylesheet" href="src/app/globals.css">
    <link rel="stylesheet" href="src/styles/design-tokens.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background);
            color: var(--foreground);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 16px;
            backdrop-filter: blur(10px);
            min-width: 200px;
        }
        
        .btn {
            background: var(--color-primary);
            color: var(--color-text-on-primary);
            border: 1px solid var(--color-border);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn:hover {
            background: var(--color-primary-hover);
            box-shadow: var(--shadow-glow);
        }
        
        .current-state {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 8px;
            background: var(--color-background-subtle);
            border-radius: 6px;
            font-family: monospace;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }
        
        .test-card {
            background: var(--color-background-elevated);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--card-shadow);
        }
        
        .test-card h3 {
            color: var(--color-text-primary);
            margin: 0 0 16px 0;
            font-size: 18px;
        }
        
        .test-card p {
            color: var(--color-text-secondary);
            margin: 0 0 12px 0;
            line-height: 1.5;
        }
        
        .color-swatches {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 16px 0;
        }
        
        .color-swatch {
            height: 48px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            display: flex;
            align-items: end;
            justify-content: center;
            padding: 4px;
            font-size: 10px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-weight: 500;
        }
        
        .validation-results {
            background: var(--color-background-elevated);
            border: 2px solid var(--color-border-success);
            border-radius: 12px;
            padding: 20px;
            margin: 24px 0;
        }
        
        .validation-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
            font-size: 14px;
        }
        
        .validation-item.pass::before {
            content: '✅';
        }
        
        .validation-item.fail::before {
            content: '❌';
        }
        
        .validation-item.pass {
            color: var(--color-success);
        }
        
        .validation-item.fail {
            color: var(--color-error);
        }
        
        .css-output {
            background: var(--color-background-subtle);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 12px;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 12px;
            color: var(--text-primary);
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .dopamine-demo {
            border-color: var(--dopamine-orange);
            box-shadow: 0 0 20px rgba(255, 107, 71, 0.3);
        }
        
        .digital-brain-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }
        
        .brain-card {
            padding: 20px;
            border-radius: 12px;
            color: white;
            text-align: center;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .card-processor { background: var(--card-processor, var(--dopamine-orange)); }
        .card-memory { background: var(--card-memory, var(--dopamine-green)); }
        .card-storage { background: var(--card-storage, var(--dopamine-light-green)); }
        .card-connection { background: var(--card-connection, var(--dopamine-indigo)); }
        .card-compact { background: var(--card-compact, var(--dopamine-yellow)); color: #333; }
        
        .focus-test {
            margin: 16px 0;
        }
        
        .focus-test input, .focus-test button {
            margin: 8px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background: var(--color-background);
            color: var(--color-text-primary);
        }
        
        .focus-test input:focus, .focus-test button:focus {
            outline: 3px solid var(--color-primary);
            outline-offset: 2px;
        }
        
        .contrast-test {
            margin: 16px 0;
            padding: 16px;
            background: var(--color-background-elevated);
            border: 1px solid var(--color-border);
            border-radius: 8px;
        }
        
        .text-samples {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .text-sample {
            padding: 8px 12px;
            border-radius: 6px;
        }
        
        .text-on-bg { background: var(--color-background); color: var(--color-text-primary); }
        .text-on-card { background: var(--color-background-elevated); color: var(--color-text-secondary); }
        .text-on-primary { background: var(--color-primary); color: var(--color-text-on-primary); }
        
        .system-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 12px;
            font-size: 12px;
            color: var(--text-muted);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <!-- 控制面板 -->
        <div class="controls">
            <h4 style="margin: 0 0 12px 0; color: var(--text-primary);">主题控制</h4>
            <div class="current-state">
                <div>主题: <span id="current-theme">default</span></div>
                <div>颜色: <span id="current-scheme">light</span></div>
            </div>
            
            <div style="margin: 12px 0 8px 0; font-size: 12px; color: var(--text-secondary);">主题选择:</div>
            <button class="btn" onclick="setTheme('warm', null)">温暖粉色</button>
            <button class="btn" onclick="setTheme('cyber', null)">科技未来</button>
            <button class="btn" onclick="setTheme('forest', null)">森林绿</button>
            <button class="btn" onclick="setTheme('dopamine', null)">多巴胺</button>
            <button class="btn" onclick="setTheme('', null)">默认</button>
            
            <div style="margin: 12px 0 8px 0; font-size: 12px; color: var(--text-secondary);">色彩模式:</div>
            <button class="btn" onclick="setTheme(null, 'light')">明亮模式</button>
            <button class="btn" onclick="setTheme(null, 'dark')">暗色模式</button>
            <button class="btn" onclick="setTheme(null, 'auto')">跟随系统</button>
            
            <div style="margin: 12px 0 8px 0; font-size: 12px; color: var(--text-secondary);">快速组合:</div>
            <button class="btn" onclick="setTheme('dopamine', 'light')">多巴胺亮色</button>
            <button class="btn" onclick="setTheme('dopamine', 'dark')">多巴胺暗色</button>
        </div>
        
        <!-- 页面标题 -->
        <div style="text-align: center; margin-bottom: 32px;">
            <h1 style="color: var(--color-text-primary); margin: 0 0 8px 0;">暗色模式选择器校验</h1>
            <p style="color: var(--color-text-secondary); margin: 0;">验证 HTML 选择器在不同主题和色彩方案组合下的行为</p>
        </div>
        
        <!-- 验证结果 -->
        <div class="validation-results">
            <h3 style="margin: 0 0 16px 0; color: var(--color-text-primary);">✨ 实时验证结果</h3>
            <div id="validation-output">
                <!-- 通过 JavaScript 动态填充 -->
            </div>
        </div>
        
        <!-- 测试网格 -->
        <div class="test-grid">
            <!-- 选择器匹配测试 -->
            <div class="test-card">
                <h3>选择器匹配状态</h3>
                <p>验证当前 DOM 状态下各种选择器的匹配情况：</p>
                <div id="selector-status" class="css-output">
                    <!-- 通过 JavaScript 动态填充 -->
                </div>
            </div>
            
            <!-- 颜色令牌测试 -->
            <div class="test-card">
                <h3>设计令牌映射</h3>
                <p>检查设计令牌是否正确映射到主题色彩变量：</p>
                <div class="color-swatches">
                    <div class="color-swatch" style="background: var(--color-primary)">Primary</div>
                    <div class="color-swatch" style="background: var(--color-primary-hover)">Hover</div>
                    <div class="color-swatch" style="background: var(--color-primary-light)">Light</div>
                    <div class="color-swatch" style="background: var(--color-success)">Success</div>
                </div>
            </div>
            
            <!-- 对比度测试 -->
            <div class="test-card">
                <h3>可访问性对比度测试</h3>
                <p>验证文本与背景的对比度是否达到 AA 级标准（≥4.5:1）：</p>
                <div class="text-samples">
                    <div class="text-sample text-on-bg">主背景上的文本 (AA级测试)</div>
                    <div class="text-sample text-on-card">卡片背景上的文本 (AA级测试)</div>
                    <div class="text-sample text-on-primary">主色背景上的文本 (AA级测试)</div>
                </div>
                <div id="contrast-results" class="css-output" style="margin-top: 12px;">
                    <!-- 对比度结果将通过 JavaScript 填充 -->
                </div>
            </div>
            
            <!-- 焦点环测试 -->
            <div class="test-card">
                <h3>焦点环可见性测试</h3>
                <p>验证交互元素的焦点环是否清晰可见：</p>
                <div class="focus-test">
                    <input type="text" placeholder="测试输入框焦点环">
                    <button>测试按钮焦点环</button>
                    <br>
                    <button style="background: var(--color-primary); color: var(--color-text-on-primary);">主色按钮焦点环</button>
                </div>
                <p style="font-size: 12px; color: var(--text-muted); margin-top: 12px;">
                    请用 Tab 键导航或点击元素测试焦点环可见性
                </p>
            </div>
        </div>
        
        <!-- Digital Brain 系统卡片测试 -->
        <div class="test-card" style="grid-column: 1 / -1;">
            <h3>Digital Brain 系统模块色彩验证</h3>
            <p>验证 digital-brain 系统的处理器/内存/存储/连接/紧凑设计卡片是否应用了预期的语义令牌：</p>
            <div class="digital-brain-cards">
                <div class="brain-card card-processor">
                    🔥 处理器
                    <div style="font-size: 12px; margin-top: 8px;">--card-processor</div>
                </div>
                <div class="brain-card card-memory">
                    💾 内存
                    <div style="font-size: 12px; margin-top: 8px;">--card-memory</div>
                </div>
                <div class="brain-card card-storage">
                    💽 存储
                    <div style="font-size: 12px; margin-top: 8px;">--card-storage</div>
                </div>
                <div class="brain-card card-connection">
                    🌐 连接
                    <div style="font-size: 12px; margin-top: 8px;">--card-connection</div>
                </div>
                <div class="brain-card card-compact">
                    ⚡ 紧凑设计
                    <div style="font-size: 12px; margin-top: 8px;">--card-compact</div>
                </div>
            </div>
        </div>
        
        <!-- CSS 变量监控 -->
        <div class="test-card" style="grid-column: 1 / -1;">
            <h3>CSS 变量实时监控</h3>
            <p>实时显示当前应用的 CSS 变量值：</p>
            <div id="css-variables" class="css-output">
                <!-- 通过 JavaScript 动态填充 -->
            </div>
        </div>
    </div>
    
    <!-- 系统信息 -->
    <div class="system-info">
        <div>User Agent Dark Mode: <span id="system-dark"></span></div>
        <div>Reduced Motion: <span id="reduced-motion"></span></div>
        <div>High Contrast: <span id="high-contrast"></span></div>
    </div>

    <script>
        // DOM 引用
        const html = document.documentElement;
        const currentThemeSpan = document.getElementById('current-theme');
        const currentSchemeSpan = document.getElementById('current-scheme');
        const validationOutput = document.getElementById('validation-output');
        const selectorStatus = document.getElementById('selector-status');
        const cssVariables = document.getElementById('css-variables');
        const contrastResults = document.getElementById('contrast-results');
        const systemDark = document.getElementById('system-dark');
        const reducedMotion = document.getElementById('reduced-motion');
        const highContrast = document.getElementById('high-contrast');
        
        // 主题切换函数
        function setTheme(theme, colorScheme) {
            if (theme !== null) {
                if (theme) {
                    html.setAttribute('data-theme', theme);
                } else {
                    html.removeAttribute('data-theme');
                }
            }
            
            if (colorScheme !== null) {
                if (colorScheme === 'auto') {
                    html.setAttribute('data-color-scheme', 'auto');
                    // 立即应用系统偏好
                    const actualScheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    html.setAttribute('data-color-scheme', actualScheme);
                } else {
                    html.setAttribute('data-color-scheme', colorScheme);
                }
            }
            
            updateStatus();
        }
        
        // 更新状态显示
        function updateStatus() {
            const theme = html.getAttribute('data-theme') || 'default';
            const scheme = html.getAttribute('data-color-scheme') || 'light';
            
            currentThemeSpan.textContent = theme;
            currentSchemeSpan.textContent = scheme;
            
            validateSelectors();
            updateCSSVariables();
            updateSystemInfo();
        }
        
        // 验证选择器
        function validateSelectors() {
            const theme = html.getAttribute('data-theme');
            const isDark = html.getAttribute('data-color-scheme') === 'dark';
            
            // 测试选择器
            const selectors = {
                'html[data-theme="dopamine"]:not(.dark)': theme === 'dopamine' && !isDark,
                'html.dark[data-theme="dopamine"]': theme === 'dopamine' && isDark,
                'html[data-theme="dopamine"]': theme === 'dopamine',
                'html[data-color-scheme="dark"]': isDark,
                'html[data-color-scheme="light"]': !isDark,
                'html[data-theme="forest"]': theme === 'forest',
                'html[data-theme="warm"]': theme === 'warm',
                'html[data-theme="cyber"]': theme === 'cyber'
            };
            
            let selectorHtml = '';
            let validationHtml = '';
            
            for (const [selector, matches] in Object.entries(selectors)) {
                const status = matches ? '✅ 匹配' : '❌ 不匹配';
                selectorHtml += `${selector}: ${status}\n`;
                
                if (selector.includes('dopamine')) {
                    const className = matches ? 'pass' : 'fail';
                    const message = matches ? '多巴胺主题选择器工作正常' : '多巴胺主题选择器未匹配';
                    validationHtml += `<div class="validation-item ${className}">${message}</div>`;
                }
            }
            
            selectorStatus.textContent = selectorHtml;
            
            // 检查是否使用了 .dark 类而不是 data-color-scheme
            const hasDarkClass = html.classList.contains('dark');
            if (hasDarkClass) {
                validationHtml += `<div class="validation-item fail">⚠️ 检测到使用了 .dark 类，建议使用 data-color-scheme="dark"</div>`;
            } else {
                validationHtml += `<div class="validation-item pass">使用标准的 data-color-scheme 属性</div>`;
            }
            
            // 检查是否有 data-mode 属性
            const dataMode = html.getAttribute('data-mode');
            if (dataMode === 'dark') {
                validationHtml += `<div class="validation-item fail">⚠️ 检测到使用了 data-mode="dark"，建议迁移到 data-color-scheme="dark"</div>`;
            }
            
            validationOutput.innerHTML = validationHtml;
        }
        
        // 更新 CSS 变量显示
        function updateCSSVariables() {
            const computedStyles = getComputedStyle(html);
            const variables = [
                '--background',
                '--foreground', 
                '--color-primary',
                '--color-primary-hover',
                '--color-text-primary',
                '--color-text-secondary',
                '--card-glass',
                '--card-border',
                '--dopamine-orange',
                '--dopamine-green',
                '--dopamine-indigo',
                '--dynamic-primary',
                '--dynamic-secondary'
            ];
            
            let html_content = '';
            variables.forEach(variable => {
                const value = computedStyles.getPropertyValue(variable).trim();
                html_content += `${variable}: ${value || '(未定义)'}\n`;
            });
            
            cssVariables.textContent = html_content;
            
            // 对比度检查
            checkContrast();
        }
        
        // 检查对比度
        function checkContrast() {
            const computedStyles = getComputedStyle(html);
            
            // 获取颜色值并计算对比度（简化版本）
            const bgColor = computedStyles.getPropertyValue('--background').trim();
            const textColor = computedStyles.getPropertyValue('--color-text-primary').trim();
            const primaryColor = computedStyles.getPropertyValue('--color-primary').trim();
            const textOnPrimary = computedStyles.getPropertyValue('--color-text-on-primary').trim();
            
            let contrastHtml = `背景色: ${bgColor}\n`;
            contrastHtml += `主文本色: ${textColor}\n`;
            contrastHtml += `主色调: ${primaryColor}\n`;
            contrastHtml += `主色上文本: ${textOnPrimary}\n\n`;
            contrastHtml += `注: 对比度计算需要专门的工具，此处仅显示颜色值\n`;
            contrastHtml += `建议使用 WebAIM Contrast Checker 等工具验证 AA 级标准`;
            
            contrastResults.textContent = contrastHtml;
        }
        
        // 更新系统信息
        function updateSystemInfo() {
            systemDark.textContent = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'Yes' : 'No';
            reducedMotion.textContent = window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 'Yes' : 'No';
            highContrast.textContent = window.matchMedia('(prefers-contrast: high)').matches ? 'Yes' : 'No';
        }
        
        // 监听系统主题变化
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (html.getAttribute('data-color-scheme') === 'auto') {
                html.setAttribute('data-color-scheme', e.matches ? 'dark' : 'light');
                updateStatus();
            }
        });
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 设置初始主题（多巴胺亮色）
            setTheme('dopamine', 'light');
            updateStatus();
            
            // 定期更新状态
            setInterval(updateStatus, 1000);
        });
        
        // 键盘快捷键
        document.addEventListener('keydown', (e) => {
            if (e.altKey && e.shiftKey) {
                switch(e.key) {
                    case '1': setTheme('warm', null); break;
                    case '2': setTheme('cyber', null); break;
                    case '3': setTheme('forest', null); break;
                    case '4': setTheme('dopamine', null); break;
                    case 'L': setTheme(null, 'light'); break;
                    case 'D': setTheme(null, 'dark'); break;
                    case 'A': setTheme(null, 'auto'); break;
                }
            }
        });
    </script>
</body>
</html>
