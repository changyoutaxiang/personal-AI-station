# ğŸ› ï¸ Digital Brain é—®é¢˜è§£å†³è®°å½•

**æ–‡æ¡£ç›®çš„**: è®°å½•å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œä¸ºæœªæ¥ç»´æŠ¤æä¾›å‚è€ƒ

---

## ğŸ› å·²è§£å†³é—®é¢˜åˆ—è¡¨

### 1. Server Actions å¼‚æ­¥è°ƒç”¨é”™è¯¯
**æ—¶é—´**: 2025-07-28  
**é—®é¢˜æè¿°**: åœ¨ Server Actions ä¸­å¯¹åŒæ­¥æ•°æ®åº“å‡½æ•°ä½¿ç”¨äº† `await` å…³é”®å­—ï¼Œå¯¼è‡´ 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯
**é”™è¯¯è¡¨ç°**: 
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º "An unexpected response was received from the server"
- ä¿å­˜è®°å½•åŠŸèƒ½å®Œå…¨æ— æ³•ä½¿ç”¨
- æœåŠ¡å™¨è¿”å› 500 çŠ¶æ€ç 

**æ ¹æœ¬åŸå› **: 
```javascript
// é”™è¯¯å†™æ³•
const entry = await createEntry(data); // createEntry æ˜¯åŒæ­¥å‡½æ•°

// æ­£ç¡®å†™æ³•  
const entry = createEntry(data);
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `src/lib/db.ts` ä¸­æ‰€æœ‰æ•°æ®åº“å‡½æ•°çš„å®šä¹‰
2. ç§»é™¤ `src/lib/actions.ts` ä¸­æ‰€æœ‰ä¸å¿…è¦çš„ `await` å…³é”®å­—
3. ä¿æŒ Server Actions å‡½æ•°ä¸º `async`ï¼Œä½†å†…éƒ¨è°ƒç”¨åŒæ­¥å‡½æ•°æ—¶ä¸ä½¿ç”¨ `await`

**é¢„é˜²æªæ–½**: åœ¨ TypeScript ä¸­æ˜ç¡®æ ‡è®°åŒæ­¥/å¼‚æ­¥å‡½æ•°ç±»å‹

---

### 2. é¡µé¢åˆ·æ–°ä½“éªŒé—®é¢˜
**æ—¶é—´**: 2025-07-28  
**é—®é¢˜æè¿°**: è¡¨å•æäº¤åä½¿ç”¨ `window.location.reload()` å¯¼è‡´é¡µé¢é—ªçƒï¼Œç”¨æˆ·ä½“éªŒå·®
**é”™è¯¯è¡¨ç°**:
- ä¿å­˜è®°å½•åæ•´ä¸ªé¡µé¢é‡æ–°åŠ è½½
- ç”¨æˆ·è¾“å…¥ç„¦ç‚¹ä¸¢å¤±
- åŠ è½½è¿‡ç¨‹ä¸­é¡µé¢é—ªçƒ

**è§£å†³æ–¹æ¡ˆ**:
1. ç§»é™¤ `window.location.reload()` è°ƒç”¨
2. ä½¿ç”¨ `CustomEvent` è¿›è¡Œç»„ä»¶é—´é€šä¿¡
3. åœ¨ EntryForm ä¸­åˆ†å‘ 'entryAdded' äº‹ä»¶
4. åœ¨ EntryList ä¸­ç›‘å¬äº‹ä»¶å¹¶é‡æ–°åŠ è½½æ•°æ®

**ä»£ç å®ç°**:
```javascript
// EntryForm.tsx
window.dispatchEvent(new CustomEvent('entryAdded'));

// EntryList.tsx  
useEffect(() => {
  const handleEntryAdded = () => loadEntries();
  window.addEventListener('entryAdded', handleEntryAdded);
  return () => window.removeEventListener('entryAdded', handleEntryAdded);
}, []);
```

---

### 3. Favicon 500 é”™è¯¯
**æ—¶é—´**: 2025-07-28  
**é—®é¢˜æè¿°**: æµè§ˆå™¨è¯·æ±‚ favicon.ico æ—¶è¿”å› 500 é”™è¯¯
**é”™è¯¯è¡¨ç°**:
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º favicon.ico 500 é”™è¯¯
- ä¸å½±å“åŠŸèƒ½ä½†å½±å“å¼€å‘ä½“éªŒ

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ `src/app/layout.tsx` çš„ metadata ä¸­æ˜ç¡®æŒ‡å®š favicon è·¯å¾„
2. æ”¹å–„åº”ç”¨çš„ title å’Œ description
3. è®¾ç½®æ­£ç¡®çš„è¯­è¨€å±æ€§ä¸º `zh-CN`

**ä»£ç å®ç°**:
```javascript
export const metadata: Metadata = {
  title: "Digital Brain - ä¸ªäººçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ",
  description: "ä»ä¿¡æ¯æ•è·åˆ°æ´å¯Ÿç”Ÿæˆçš„å®Œæ•´é—­ç¯",
  icons: {
    icon: '/favicon.ico',
  },
};
```

---

### 4. ç«¯å£è®¿é—®é—®é¢˜
**æ—¶é—´**: 2025-07-28  
**é—®é¢˜æè¿°**: é»˜è®¤ç«¯å£ 3000 å’Œ 3001 æ— æ³•æ­£å¸¸è®¿é—®ï¼Œcurl è¿”å›è¿æ¥æ‹’ç»
**é”™è¯¯è¡¨ç°**:
- `curl: (7) Failed to connect to localhost port 3001`
- æœåŠ¡å™¨æ˜¾ç¤ºå¯åŠ¨æˆåŠŸä½†å®é™…æ— æ³•è¿æ¥
- `lsof` æ˜¾ç¤ºç«¯å£æœªè¢«ç›‘å¬

**æ ¹æœ¬åŸå› **: 
- ç«¯å£ 3000 è¢«å…¶ä»–è¿›ç¨‹å ç”¨
- ç½‘ç»œé…ç½®å¯èƒ½å­˜åœ¨é—®é¢˜
- hostname ç»‘å®šé—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ä¸åŒç«¯å£ (4000)
2. æ˜¾å¼æŒ‡å®š hostname ä¸º `0.0.0.0`
3. æ¸…ç† Next.js ç¼“å­˜ (`rm -rf .next`)
4. ä½¿ç”¨æ ‡å‡† Next.js è€Œé Turbopack æ¨¡å¼

**æœ€ç»ˆå¯åŠ¨å‘½ä»¤**:
```bash
npx next dev --port 4000 --hostname 0.0.0.0
```

---

### 5. æ•°æ®åº“åˆå§‹åŒ–æ—¶æœºé—®é¢˜
**æ—¶é—´**: 2025-07-28  
**é—®é¢˜æè¿°**: åº”ç”¨å¯åŠ¨æ—¶å¯èƒ½å‡ºç°æ•°æ®åº“æœªåˆå§‹åŒ–çš„æƒ…å†µ
**è§£å†³æ–¹æ¡ˆ**: åœ¨ä¸»é¡µé¢ç»„ä»¶ä¸­æ·»åŠ æ•°æ®åº“åˆå§‹åŒ–è°ƒç”¨ï¼ˆå·²åæ¥ç§»é™¤ï¼Œæ”¹ä¸ºæ‰‹åŠ¨åˆå§‹åŒ–ï¼‰

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. æœåŠ¡å™¨æ—¥å¿—ç›‘æ§
- ä½¿ç”¨åå°å¯åŠ¨: `npm run dev > server.log 2>&1 &`
- å®æ—¶æŸ¥çœ‹æ—¥å¿—: `tail -f server.log`
- æ£€æŸ¥ç«¯å£ç›‘å¬: `lsof -i :4000`

### 2. æ•°æ®åº“è°ƒè¯•
- æ£€æŸ¥æ•°æ®åº“å¥åº·: `node -e "require('./src/lib/db.ts').checkDatabaseHealth()"`
- æŸ¥çœ‹è¡¨ç»“æ„: `sqlite3 data/digital-brain.db ".schema"`
- æŸ¥çœ‹æ•°æ®: `sqlite3 data/digital-brain.db "SELECT * FROM entries;"`

### 3. è¿›ç¨‹ç®¡ç†
- æŸ¥æ‰¾ç«¯å£å ç”¨: `lsof -i :3000`
- å¼ºåˆ¶æ€æ­»è¿›ç¨‹: `kill -9 <PID>`
- æ¸…ç†ç›¸å…³è¿›ç¨‹: `pkill -f "next-server"`

---

## ğŸ“‹ é¢„é˜²æ¸…å•

### å¼€å‘å‰æ£€æŸ¥
- [ ] ç¡®è®¤ Node.js ç‰ˆæœ¬ >= 24
- [ ] æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
- [ ] ç¡®ä¿æ•°æ®ç›®å½•æƒé™æ­£ç¡®
- [ ] æ¸…ç† `.next` ç¼“å­˜

### éƒ¨ç½²å‰æ£€æŸ¥  
- [ ] è¿è¡Œ `npm run build` ç¡®è®¤æ„å»ºæˆåŠŸ
- [ ] è¿è¡Œ `npm run lint` ç¡®è®¤ä»£ç è´¨é‡
- [ ] æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- [ ] éªŒè¯æ‰€æœ‰ç¯å¢ƒå˜é‡

### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] åŒæ­¥å‡½æ•°ä¸ä½¿ç”¨ `await`
- [ ] Server Actions é”™è¯¯å¤„ç†å®Œæ•´
- [ ] TypeScript ç±»å‹å®šä¹‰å‡†ç¡®
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–åˆ°ä½

---

## ğŸš¨ ç´§æ€¥é—®é¢˜å¤„ç†æµç¨‹

1. **æœåŠ¡æ— æ³•å¯åŠ¨**
   - æ£€æŸ¥ç«¯å£å ç”¨: `lsof -i :4000`
   - æ¸…ç†ç¼“å­˜: `rm -rf .next`
   - é‡å¯åº”ç”¨: `npx next dev --port 4000 --hostname 0.0.0.0`

2. **æ•°æ®åº“é”™è¯¯**
   - å¤‡ä»½æ•°æ®åº“: `cp data/digital-brain.db data/backup.db`
   - é‡æ–°åˆå§‹åŒ–: `node -e "require('./src/lib/init-db.ts').initDB()"`
   - æ¢å¤æ•°æ®: ä»å¤‡ä»½æ–‡ä»¶æ¢å¤

3. **åŠŸèƒ½å¼‚å¸¸**
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
   - æŸ¥çœ‹ server.log æœåŠ¡å™¨æ—¥å¿—  
   - å¯¹æ¯” PROGRESS_BACKUP.md ä¸­çš„æ­£å¸¸çŠ¶æ€

---

**ç»´æŠ¤è€…**: Claude Code  
**æœ€åæ›´æ–°**: 2025-07-28  
**ç‰ˆæœ¬**: v1.0